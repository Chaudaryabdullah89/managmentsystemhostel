generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Booking {
  id              String        @id @default(cuid())
  uid             String?       @unique
  userId          String
  roomId          String
  checkIn         DateTime
  checkOut        DateTime?
  status          BookingStatus @default(PENDING)
  totalAmount     Float
  securityDeposit Float         @default(0)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  Room            Room          @relation(fields: [roomId], references: [id])
  User            User          @relation(fields: [userId], references: [id])
  Payment         Payment[]
}

model Complaint {
  id                                String             @id @default(cuid())
  uid                               String?            @unique
  userId                            String
  hostelId                          String
  roomNumber                        String?
  title                             String
  description                       String
  category                          ComplaintCategory
  priority                          ComplaintPriority  @default(MEDIUM)
  status                            ComplaintStatus    @default(PENDING)
  assignedToId                      String?
  resolutionNotes                   String?
  resolvedAt                        DateTime?
  images                            String[]
  createdAt                         DateTime           @default(now())
  updatedAt                         DateTime
  User_Complaint_assignedToIdToUser User?              @relation("Complaint_assignedToIdToUser", fields: [assignedToId], references: [id])
  Hostel                            Hostel             @relation(fields: [hostelId], references: [id])
  User_Complaint_userIdToUser       User               @relation("Complaint_userIdToUser", fields: [userId], references: [id])
  comments                          ComplaintComment[]
}

model ComplaintComment {
  id          String   @id @default(cuid())
  complaintId String
  userId      String
  message     String
  createdAt   DateTime @default(now())

  Complaint Complaint @relation(fields: [complaintId], references: [id], onDelete: Cascade)
  User      User      @relation(fields: [userId], references: [id])
}

model Expense {
  id                               String          @id @default(cuid())
  hostelId                         String
  title                            String
  description                      String?
  amount                           Float
  date                             DateTime        @default(now())
  category                         ExpenseCategory
  status                           ExpenseStatus   @default(PENDING)
  receiptUrl                       String?
  submittedById                    String
  approvedById                     String?
  createdAt                        DateTime        @default(now())
  updatedAt                        DateTime
  rejectedById                     String?
  userId                           String?
  User_Expense_approvedByIdToUser  User?           @relation("Expense_approvedByIdToUser", fields: [approvedById], references: [id])
  Hostel                           Hostel          @relation(fields: [hostelId], references: [id])
  User_Expense_rejectedByIdToUser  User?           @relation("Expense_rejectedByIdToUser", fields: [rejectedById], references: [id])
  User_Expense_submittedByIdToUser User            @relation("Expense_submittedByIdToUser", fields: [submittedById], references: [id])
  User_Expense_userIdToUser        User?           @relation("Expense_userIdToUser", fields: [userId], references: [id])
}

model Hostel {
  id                          String        @id @default(cuid())
  name                        String
  type                        HostelType    @default(BOYS)
  address                     String
  city                        String
  state                       String?
  country                     String        @default("Pakistan")
  phone                       String?
  email                       String?
  description                 String?
  floors                      Int           @default(1)
  amenities                   String[]
  images                      String[]
  managerId                   String?
  createdAt                   DateTime      @default(now())
  updatedAt                   DateTime
  completeaddress             String?
  laundaryavailable           Boolean?      @default(false)
  messavailable               Boolean?      @default(false)
  montlyrent                  Float?
  pernightrent                Float?
  status                      String?       @default("ACTIVE")
  totalRooms                  Int?          @default(0)
  wardens                     String[]
  zip                         String?
  cleaningInterval            Int?          @default(24) // in hours
  laundryInterval             Int?          @default(48) // in hours
  Complaint                   Complaint[]
  Expense                     Expense[]
  User_Hostel_managerIdToUser User?         @relation("Hostel_managerIdToUser", fields: [managerId], references: [id])
  Room                        Room[]
  User_User_hostelIdToHostel  User[]        @relation("User_hostelIdToHostel")
  maintanance                 maintanance[]
  CleaningLog                 CleaningLog[]
  LaundryLog                  LaundryLog[]
  staffTasks                  StaffTask[]
}

model OtpVerification {
  id        String   @id @default(cuid())
  email     String
  otp       String
  expiresAt DateTime
  type      String   @default("EMAIL_UPDATE")
  createdAt DateTime @default(now())
}

model Payment {
  id            String        @id @default(cuid())
  uid           String?       @unique
  userId        String
  bookingId     String?
  amount        Float
  date          DateTime      @default(now())
  dueDate       DateTime?
  type          String
  status        PaymentStatus @default(PENDING)
  method        PaymentMethod @default(CASH)
  transactionId String?
  receiptUrl    String?
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  Booking       Booking?      @relation(fields: [bookingId], references: [id])
  User          User          @relation(fields: [userId], references: [id])
}

model ResidentProfile {
  id               String  @id @default(cuid())
  userId           String  @unique
  guardianName     String?
  guardianPhone    String?
  emergencyContact String?
  address          String?
  city             String?
  currentHostelId  String?
  currentRoomId    String?
  documents        Json?
  User             User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Room {
  id               String        @id @default(cuid())
  hostelId         String
  roomNumber       String
  floor            Int
  type             RoomType      @default(TRIPLE)
  capacity         Int           @default(3)
  price            Float
  pricepernight    Float
  monthlyrent      Float
  status           RoomStatus    @default(AVAILABLE)
  amenities        String[]
  images           String[]
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  lastCleaningAt   DateTime?
  lastLaundryAt    DateTime?
  cleaningInterval Int?          @default(24) // in hours
  laundryInterval  Int?          @default(48) // in hours
  Booking          Booking[]
  Hostel           Hostel        @relation(fields: [hostelId], references: [id], onDelete: Cascade)
  maintanance      maintanance[]
  CleaningLog      CleaningLog[]
  LaundryLog       LaundryLog[]

  @@unique([hostelId, roomNumber])
}

model CleaningLog {
  id          String   @id @default(cuid())
  roomId      String
  staffId     String?
  status      String   @default("COMPLETED") // COMPLETED, PENDING, SKIPPED
  notes       String?
  performedAt DateTime @default(now())
  createdAt   DateTime @default(now())
  Room        Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  hostel      Hostel?  @relation(fields: [hostelId], references: [id])
  hostelId    String?
}

model LaundryLog {
  id          String    @id @default(cuid())
  roomId      String
  residentId  String?
  status      String    @default("PENDING") // PENDING, PROCESSING, READY, DELIVERED
  itemsCount  Int       @default(0)
  weight      Float?
  notes       String?
  receivedAt  DateTime  @default(now())
  deliveredAt DateTime?
  createdAt   DateTime  @default(now())
  Room        Room      @relation(fields: [roomId], references: [id], onDelete: Cascade)
  hostel      Hostel?   @relation(fields: [hostelId], references: [id])
  hostelId    String?
}

model Salary {
  id             String         @id @default(cuid())
  staffId        String
  month          String
  amount         Float
  basicSalary    Float
  allowances     Float          @default(0)
  bonuses        Float          @default(0)
  deductions     Float          @default(0)
  status         PaymentStatus  @default(PENDING)
  paymentDate    DateTime?
  paymentMethod  PaymentMethod?
  notes          String?
  appealText     String?
  appealStatus   String?        @default("NONE") // NONE, PENDING, RESOLVED, REJECTED
  appealResponse String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  StaffProfile   StaffProfile   @relation(fields: [staffId], references: [id])
}

model Session {
  id         String    @id @default(cuid())
  userId     String
  token      String?   @unique
  device     String?
  ipAddress  String?
  lastActive DateTime  @default(now())
  expiresAt  DateTime?
  isActive   Boolean   @default(true)
  createdAt  DateTime  @default(now())
  User       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model StaffProfile {
  id          String   @id @default(cuid())
  userId      String   @unique
  designation String
  department  String?
  shift       String?
  basicSalary Float    @default(0)
  allowances  Float    @default(0)
  joiningDate DateTime @default(now())
  documents   Json?
  Salary      Salary[]
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                                         String             @id @default(cuid())
  uid                                        String?            @unique
  name                                       String
  email                                      String             @unique
  password                                   String
  createdAt                                  DateTime           @default(now())
  updatedAt                                  DateTime
  cnic                                       String?
  image                                      String?
  isActive                                   Boolean            @default(true)
  phone                                      String?
  role                                       UserRole           @default(GUEST)
  address                                    String?
  lastLogin                                  DateTime?
  city                                       String?
  hostelId                                   String?
  wardens                                    String[]
  Booking                                    Booking[]
  Complaint_Complaint_assignedToIdToUser     Complaint[]        @relation("Complaint_assignedToIdToUser")
  Complaint_Complaint_userIdToUser           Complaint[]        @relation("Complaint_userIdToUser")
  Expense_Expense_approvedByIdToUser         Expense[]          @relation("Expense_approvedByIdToUser")
  Expense_Expense_rejectedByIdToUser         Expense[]          @relation("Expense_rejectedByIdToUser")
  Expense_Expense_submittedByIdToUser        Expense[]          @relation("Expense_submittedByIdToUser")
  Expense_Expense_userIdToUser               Expense[]          @relation("Expense_userIdToUser")
  Hostel_Hostel_managerIdToUser              Hostel[]           @relation("Hostel_managerIdToUser")
  Payment                                    Payment[]
  ResidentProfile                            ResidentProfile?
  Session                                    Session[]
  StaffProfile                               StaffProfile?
  Hostel_User_hostelIdToHostel               Hostel?            @relation("User_hostelIdToHostel", fields: [hostelId], references: [id])
  maintanance_maintanance_assignedToIdToUser maintanance[]      @relation("maintanance_assignedToIdToUser")
  maintanance_maintanance_userIdToUser       maintanance[]      @relation("maintanance_userIdToUser")
  complaintComments                          ComplaintComment[]
  assignedTasks                              StaffTask[]        @relation("Task_AssignedTo")
  createdTasks                               StaffTask[]        @relation("Task_CreatedBy")
  taskComments                               TaskComment[]
}

model StaffTask {
  id          String       @id @default(cuid())
  uid         String?      @unique
  title       String
  description String?
  status      TaskStatus   @default(PENDING)
  priority    TaskPriority @default(MEDIUM)
  category    String?      @default("GENERAL") // CLEANING, MAINTENANCE, SECURITY, etc.

  hostelId String
  hostel   Hostel @relation(fields: [hostelId], references: [id])

  assignedToId String?
  assignedTo   User?   @relation("Task_AssignedTo", fields: [assignedToId], references: [id])

  createdById String
  createdBy   User   @relation("Task_CreatedBy", fields: [createdById], references: [id])

  dueDate     DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  comments TaskComment[]
}

model TaskComment {
  id        String   @id @default(cuid())
  taskId    String
  userId    String
  message   String
  createdAt DateTime @default(now())

  Task StaffTask @relation(fields: [taskId], references: [id], onDelete: Cascade)
  User User      @relation(fields: [userId], references: [id])
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

model maintanance {
  id                                  String    @id @default(cuid())
  uid                                 String?   @unique
  hostelId                            String
  roomId                              String?
  title                               String
  description                         String?
  status                              String    @default("PENDING")
  priority                            String    @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  assignedToId                        String?
  resolutionNotes                     String?
  resolvedAt                          DateTime?
  images                              String[]
  createdAt                           DateTime  @default(now())
  updatedAt                           DateTime  @updatedAt
  userId                              String?
  User_maintanance_assignedToIdToUser User?     @relation("maintanance_assignedToIdToUser", fields: [assignedToId], references: [id])
  Hostel                              Hostel    @relation(fields: [hostelId], references: [id])
  Room                                Room?     @relation(fields: [roomId], references: [id])
  User_maintanance_userIdToUser       User?     @relation("maintanance_userIdToUser", fields: [userId], references: [id])
}

model resetPassword {
  id        String   @id @default(cuid())
  email     String   @unique
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  userId    String   @unique

  @@index([email])
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  REJECTED
  CHECKED_IN
  CHECKED_OUT
}

enum ComplaintCategory {
  MAINTENANCE
  CLEANLINESS
  NOISE
  SECURITY
  INTERNET
  OTHER
}

enum ComplaintPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ComplaintStatus {
  PENDING
  IN_PROGRESS
  RESOLVED
  REJECTED
}

enum ExpenseCategory {
  UTILITIES
  MAINTENANCE
  SALARIES
  SUPPLIES
  GROCERIES
  OTHER
}

enum ExpenseStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

enum HostelType {
  BOYS
  GIRLS
  MIXED
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  ONLINE
  CHEQUE
  OTHER
}

enum PaymentStatus {
  PENDING
  PAID
  OVERDUE
  PARTIAL
  FAILED
  REFUNDED
  REJECTED
}

enum RoomStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
  CLEANING
}

enum RoomType {
  SINGLE
  DOUBLE
  TRIPLE
  DORMITORY
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  WARDEN
  STAFF
  RESIDENT
  GUEST
}
