generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Booking {
  id              String        @id @default(cuid())
  userId          String
  roomId          String
  checkIn         DateTime
  checkOut        DateTime?
  status          BookingStatus @default(PENDING)
  totalAmount     Float
  securityDeposit Float         @default(0)
  monthlyRent     Float?        @default(0)
  uid             String?       @unique
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  Room            Room          @relation(fields: [roomId], references: [id])
  User            User          @relation(fields: [userId], references: [id])
  Payment         Payment[]
}

model Complaint {
  id                                String            @id @default(cuid())
  userId                            String
  hostelId                          String
  roomNumber                        String?
  title                             String
  description                       String
  category                          ComplaintCategory
  priority                          ComplaintPriority @default(MEDIUM)
  status                            ComplaintStatus   @default(PENDING)
  assignedToId                      String?
  resolutionNotes                   String?
  resolvedAt                        DateTime?
  images                            String[]
  uid                               String?           @unique
  createdAt                         DateTime          @default(now())
  updatedAt                         DateTime          @updatedAt
  User_Complaint_assignedToIdToUser User?             @relation("Complaint_assignedToIdToUser", fields: [assignedToId], references: [id])
  Hostel                            Hostel            @relation(fields: [hostelId], references: [id])
  User_Complaint_userIdToUser       User              @relation("Complaint_userIdToUser", fields: [userId], references: [id])
}

model Expense {
  id                               String          @id @default(cuid())
  hostelId                         String
  title                            String
  description                      String?
  amount                           Float
  date                             DateTime        @default(now())
  category                         ExpenseCategory
  status                           ExpenseStatus   @default(PENDING)
  receiptUrl                       String?
  submittedById                    String
  approvedById                     String?
  createdAt                        DateTime        @default(now())
  updatedAt                        DateTime        @updatedAt
  rejectedById                     String?
  userId                           String?
  User_Expense_approvedByIdToUser  User?           @relation("Expense_approvedByIdToUser", fields: [approvedById], references: [id])
  Hostel                           Hostel          @relation(fields: [hostelId], references: [id])
  User_Expense_rejectedByIdToUser  User?           @relation("Expense_rejectedByIdToUser", fields: [rejectedById], references: [id])
  User_Expense_submittedByIdToUser User            @relation("Expense_submittedByIdToUser", fields: [submittedById], references: [id])
  User_Expense_userIdToUser        User?           @relation("Expense_userIdToUser", fields: [userId], references: [id])
}

model Hostel {
  id                          String          @id @default(cuid())
  name                        String
  type                        HostelType      @default(BOYS)
  address                     String
  city                        String
  state                       String?
  country                     String          @default("Pakistan")
  phone                       String?
  email                       String?
  description                 String?
  floors                      Int             @default(1)
  amenities                   String[]
  images                      String[]
  managerId                   String?
  createdAt                   DateTime        @default(now())
  updatedAt                   DateTime        @updatedAt
  completeaddress             String?
  laundaryavailable           Boolean?        @default(false)
  messavailable               Boolean?        @default(false)
  montlyrent                  Float?
  pernightrent                Float?
  status                      String?         @default("ACTIVE")
  totalRooms                  Int?            @default(0)
  wardens                     String[]
  zip                         String?
  Complaint                   Complaint[]
  Expense                     Expense[]
  User_Hostel_managerIdToUser User?           @relation("Hostel_managerIdToUser", fields: [managerId], references: [id])
  Room                        Room[]
  User_User_hostelIdToHostel  User[]          @relation("User_hostelIdToHostel")
  maintanance                 maintanance[]
  Notice                      Notice[]
  MessMenu                    MessMenu[]
  staffTasks                  StaffTask[]
  RefundRequest               RefundRequest[]
  cleaningLogs                CleaningLog[]
  laundryLogs                 LaundryLog[]
}

model MessMenu {
  id            String   @id @default(cuid())
  hostelId      String
  dayOfWeek     String
  breakfast     String?
  breakfastTime String?
  lunch         String?
  lunchTime     String?
  dinner        String?
  dinnerTime    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  Hostel Hostel @relation(fields: [hostelId], references: [id], onDelete: Cascade)

  @@unique([hostelId, dayOfWeek], name: "hostelId_dayOfWeek")
}

model Notice {
  id          String    @id @default(cuid())
  title       String
  content     String
  priority    String    @default("MEDIUM")
  category    String    @default("GENERAL")
  targetRoles String[]
  hostelId    String?
  authorId    String
  isActive    Boolean   @default(true)
  expiresAt   DateTime?
  uid         String?   @unique
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  author User    @relation(fields: [authorId], references: [id])
  hostel Hostel? @relation(fields: [hostelId], references: [id])
}

model OtpVerification {
  id        String   @id
  email     String
  otp       String
  expiresAt DateTime
  type      String   @default("EMAIL_UPDATE")
  createdAt DateTime @default(now())
}

model Payment {
  id            String          @id @default(cuid())
  userId        String
  bookingId     String?
  amount        Float
  date          DateTime        @default(now())
  dueDate       DateTime?
  type          String
  status        PaymentStatus   @default(PENDING)
  method        PaymentMethod   @default(CASH)
  transactionId String?
  receiptUrl    String?
  notes         String?
  month         String?
  year          Int?
  uid           String?         @unique
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  Booking       Booking?        @relation(fields: [bookingId], references: [id])
  User          User            @relation(fields: [userId], references: [id])
  RefundRequest RefundRequest[]
}

model ResidentProfile {
  id               String  @id @default(cuid())
  userId           String  @unique
  guardianName     String?
  guardianPhone    String?
  emergencyContact String?
  address          String?
  city             String?
  currentHostelId  String?
  currentRoomId    String?
  documents        Json?
  User             User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Room {
  id               String        @id @default(cuid())
  hostelId         String
  roomNumber       String
  floor            Int
  type             RoomType      @default(TRIPLE)
  capacity         Int           @default(3)
  price            Float
  status           RoomStatus    @default(AVAILABLE)
  amenities        String[]
  images           String[]
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  lastCleaningAt   DateTime?
  lastLaundryAt    DateTime?
  cleaningInterval Int?          @default(24)
  laundryInterval  Int?          @default(48)
  montlyrent       Float?
  pernightrent     Float?
  Booking          Booking[]
  Hostel           Hostel        @relation(fields: [hostelId], references: [id], onDelete: Cascade)
  CleaningLog      CleaningLog[]
  LaundryLog       LaundryLog[]
  maintanance      maintanance[]

  @@unique([hostelId, roomNumber])
}

model Salary {
  id             String         @id @default(cuid())
  staffProfileId String
  month          String
  amount         Float
  basicSalary    Float
  allowances     Float          @default(0)
  bonuses        Float          @default(0)
  deductions     Float          @default(0)
  status         PaymentStatus  @default(PENDING)
  paymentDate    DateTime?
  paymentMethod  PaymentMethod?
  notes          String?
  uid            String?        @unique
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  StaffProfile   StaffProfile   @relation(fields: [staffProfileId], references: [id])
}

model Session {
  id         String    @id @default(cuid())
  userId     String
  token      String?   @unique
  device     String?
  ipAddress  String?
  lastActive DateTime  @default(now())
  expiresAt  DateTime?
  isActive   Boolean   @default(true)
  createdAt  DateTime  @default(now())
  User       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model StaffProfile {
  id          String   @id @default(cuid())
  userId      String   @unique
  designation String
  department  String?
  shift       String?
  basicSalary Float    @default(0)
  allowances  Float    @default(0)
  joiningDate DateTime @default(now())
  documents   Json?
  Salary      Salary[]
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                                         String           @id @default(cuid())
  name                                       String
  email                                      String           @unique
  password                                   String
  uid                                        String?          @unique
  assignedTasks                              StaffTask[]      @relation("Task_AssignedTo")
  createdTasks                               StaffTask[]      @relation("Task_CreatedBy")
  taskComments                               TaskComment[]
  WardenPayment                              WardenPayment[]
  createdAt                                  DateTime         @default(now())
  updatedAt                                  DateTime         @updatedAt
  cnic                                       String?
  image                                      String?
  isActive                                   Boolean          @default(true)
  phone                                      String?
  role                                       UserRole         @default(GUEST)
  address                                    String?
  lastLogin                                  DateTime?
  city                                       String?
  hostelId                                   String?
  basicSalary                                Float            @default(0)
  allowances                                 Float            @default(0)
  wardens                                    String[]
  Booking                                    Booking[]
  Complaint_Complaint_assignedToIdToUser     Complaint[]      @relation("Complaint_assignedToIdToUser")
  Complaint_Complaint_userIdToUser           Complaint[]      @relation("Complaint_userIdToUser")
  Expense_Expense_approvedByIdToUser         Expense[]        @relation("Expense_approvedByIdToUser")
  Expense_Expense_rejectedByIdToUser         Expense[]        @relation("Expense_rejectedByIdToUser")
  Expense_Expense_submittedByIdToUser        Expense[]        @relation("Expense_submittedByIdToUser")
  Expense_Expense_userIdToUser               Expense[]        @relation("Expense_userIdToUser")
  Hostel_Hostel_managerIdToUser              Hostel[]         @relation("Hostel_managerIdToUser")
  Payment                                    Payment[]
  ResidentProfile                            ResidentProfile?
  Session                                    Session[]
  StaffProfile                               StaffProfile?
  Hostel_User_hostelIdToHostel               Hostel?          @relation("User_hostelIdToHostel", fields: [hostelId], references: [id])
  maintanance_maintanance_assignedToIdToUser maintanance[]    @relation("maintanance_assignedToIdToUser")
  maintanance_maintanance_userIdToUser       maintanance[]    @relation("maintanance_userIdToUser")
  Notice                                     Notice[]
  RefundRequest                              RefundRequest[]
}

model maintanance {
  id                                  String    @id @default(cuid())
  hostelId                            String
  title                               String
  description                         String?
  status                              String    @default("PENDING")
  assignedToId                        String?
  resolutionNotes                     String?
  resolvedAt                          DateTime?
  images                              String[]
  uid                                 String?   @unique
  createdAt                           DateTime  @default(now())
  updatedAt                           DateTime  @updatedAt
  userId                              String?
  roomId                              String?
  User_maintanance_assignedToIdToUser User?     @relation("maintanance_assignedToIdToUser", fields: [assignedToId], references: [id])
  Hostel                              Hostel    @relation(fields: [hostelId], references: [id])
  User_maintanance_userIdToUser       User?     @relation("maintanance_userIdToUser", fields: [userId], references: [id])
  Room                                Room?     @relation(fields: [roomId], references: [id])
}

model resetPassword {
  id        String   @id
  email     String   @unique
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  userId    String   @unique

  @@index([email])
}

model CleaningLog {
  id          String   @id @default(cuid())
  roomId      String
  hostelId    String
  status      String   @default("COMPLETED")
  notes       String?
  performedAt DateTime @default(now())
  createdAt   DateTime @default(now())

  Room   Room   @relation(fields: [roomId], references: [id], onDelete: Cascade)
  Hostel Hostel @relation(fields: [hostelId], references: [id], onDelete: Cascade)
}

model LaundryLog {
  id          String    @id @default(cuid())
  roomId      String
  hostelId    String
  itemsCount  Int       @default(0)
  status      String    @default("PENDING")
  notes       String?
  receivedAt  DateTime  @default(now())
  createdAt   DateTime  @default(now())
  deliveredAt DateTime?

  Room   Room   @relation(fields: [roomId], references: [id], onDelete: Cascade)
  Hostel Hostel @relation(fields: [hostelId], references: [id], onDelete: Cascade)
}

model WardenPayment {
  id            String   @id @default(cuid())
  wardenId      String
  amount        Float
  basicSalary   Float
  bonuses       Float    @default(0)
  deductions    Float    @default(0)
  month         String
  paymentMethod String   @default("BANK_TRANSFER")
  paymentDate   DateTime @default(now())
  notes         String?
  status        String   @default("PAID")
  type          String   @default("WARDEN_SALARY")
  uid           String?  @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  Warden        User     @relation(fields: [wardenId], references: [id])
}

model StaffTask {
  id          String       @id @default(cuid())
  uid         String?      @unique
  title       String
  description String?
  status      TaskStatus   @default(PENDING)
  priority    TaskPriority @default(MEDIUM)
  category    String?      @default("GENERAL")

  hostelId String
  hostel   Hostel @relation(fields: [hostelId], references: [id])

  assignedToId String?
  assignedTo   User?   @relation("Task_AssignedTo", fields: [assignedToId], references: [id])

  createdById String
  createdBy   User   @relation("Task_CreatedBy", fields: [createdById], references: [id])

  dueDate     DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  comments TaskComment[]
}

model TaskComment {
  id        String   @id @default(cuid())
  taskId    String
  userId    String
  message   String
  createdAt DateTime @default(now())

  Task StaffTask @relation(fields: [taskId], references: [id], onDelete: Cascade)
  User User      @relation(fields: [userId], references: [id])
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  REJECTED
  CHECKED_IN
  CHECKED_OUT
}

enum ComplaintCategory {
  MAINTENANCE
  CLEANLINESS
  NOISE
  SECURITY
  INTERNET
  OTHER
}

enum ComplaintPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ComplaintStatus {
  PENDING
  IN_PROGRESS
  RESOLVED
  REJECTED
}

enum ExpenseCategory {
  UTILITIES
  MAINTENANCE
  SALARIES
  SUPPLIES
  GROCERIES
  OTHER
}

enum ExpenseStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

enum HostelType {
  BOYS
  GIRLS
  MIXED
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  ONLINE
  CHEQUE
  OTHER
}

enum PaymentStatus {
  PENDING
  PAID
  OVERDUE
  PARTIAL
  FAILED
  REFUNDED
  REJECTED
}

enum RoomStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
  CLEANING
}

enum RoomType {
  SINGLE
  DOUBLE
  TRIPLE
  DORMITORY
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  WARDEN
  STAFF
  RESIDENT
  GUEST
}

model RefundRequest {
  id        String   @id @default(cuid())
  paymentId String
  userId    String
  hostelId  String
  reason    String
  amount    Float
  status    String   @default("PENDING")
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  User    User    @relation(fields: [userId], references: [id])
  Payment Payment @relation(fields: [paymentId], references: [id])
  Hostel  Hostel  @relation(fields: [hostelId], references: [id])
}
