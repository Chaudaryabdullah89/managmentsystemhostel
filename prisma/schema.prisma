generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Booking {
  id              String        @id @default(cuid())
  userId          String
  roomId          String
  checkIn         DateTime
  checkOut        DateTime?
  status          BookingStatus @default(PENDING)
  totalAmount     Float
  securityDeposit Float         @default(0)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  Room            Room          @relation(fields: [roomId], references: [id])
  User            User          @relation(fields: [userId], references: [id])
  hostel          Hostel?       @relation(fields: [hostelId], references: [id])
  hostelId        String?
}

model Complaint {
  id           String             @id @default(cuid())
  userId       String
  hostelId     String?
  subject      String
  description  String
  status       ComplaintStatus    @default(PENDING)
  priority     ComplaintPriority  @default(MEDIUM)
  category     ComplaintCategory?
  assignedToId String?
  resolvedAt   DateTime?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  assignedTo   User?              @relation("Complaint_assignedToIdToUser", fields: [assignedToId], references: [id])
  Hostel       Hostel?            @relation(fields: [hostelId], references: [id])
  User         User               @relation("Complaint_userIdToUser", fields: [userId], references: [id])
  comments     ComplaintComment[]
}

model ComplaintComment {
  id          String    @id @default(cuid())
  complaintId String
  userId      String
  message     String
  createdAt   DateTime  @default(now())
  Complaint   Complaint @relation(fields: [complaintId], references: [id], onDelete: Cascade)
  User        User      @relation(fields: [userId], references: [id])
}

model Expense {
  id              String        @id @default(cuid())
  hostelId        String
  userId          String
  title           String
  amount          Float
  category        String
  date            DateTime      @default(now())
  status          ExpenseStatus @default(PENDING)
  description     String?
  receipt         String?
  approvedById    String?
  rejectedById    String?
  rejectionReason String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  approvedBy      User?         @relation("Expense_approvedByIdToUser", fields: [approvedById], references: [id])
  Hostel          Hostel        @relation(fields: [hostelId], references: [id])
  rejectedBy      User?         @relation("Expense_rejectedByIdToUser", fields: [rejectedById], references: [id])
  submittedBy     User          @relation("Expense_userIdToUser", fields: [userId], references: [id])
}

model Hostel {
  id                         String          @id @default(cuid())
  name                       String
  address                    String
  floors                     Int             @default(1)
  rooms                      Int             @default(0)
  managerId                  String?
  createdAt                  DateTime        @default(now())
  updatedAt                  DateTime        @updatedAt
  city                       String?
  completeAddress            String?
  contact                    String?
  country                    String?
  description                String?
  email                      String?
  image                      String?
  laundry                    String?
  mess                       String?
  state                      String?
  status                     String          @default("Active")
  street                     String?
  zip                        String?
  type                       String          @default("BOYS")
  cleaningInterval           Int             @default(24)
  laundryInterval            Int             @default(48)
  montlypayment              Float?          @default(0)
  pricePerNight              Float?          @default(0)
  Booking                    Booking[]
  Complaint                  Complaint[]
  Expense                    Expense[]
  Manager                    User?           @relation("Hostel_managerIdToUser", fields: [managerId], references: [id])
  Payment                    Payment[]
  RefundRequest              RefundRequest[]
  Room                       Room[]
  User_User_hostelIdToHostel User[]          @relation("User_hostelIdToHostel")
  maintanance                maintanance[]
  StaffTask                  StaffTask[]
  MessMenu                   MessMenu[]
  Notice                     Notice[]
}

model OtpVerification {
  id        String   @id @default(cuid())
  email     String
  otp       String
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([email])
}

model Payment {
  id            String        @id @default(cuid())
  userId        String
  amount        Float
  status        PaymentStatus @default(PENDING)
  method        PaymentMethod @default(CASH)
  month         String?
  type          PaymentType?
  receiptImage  String?
  transactionId String?
  paymentDate   DateTime      @default(now())
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  User          User          @relation(fields: [userId], references: [id])
  hostel        Hostel?       @relation(fields: [hostelId], references: [id])
  hostelId      String?
}

model RefundRequest {
  id          String       @id @default(cuid())
  userId      String
  hostelId    String
  amount      Float
  reason      String
  status      RefundStatus @default(PENDING)
  processedAt DateTime?
  adminNotes  String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  Hostel      Hostel       @relation(fields: [hostelId], references: [id])
  User        User         @relation(fields: [userId], references: [id])
}

model ResidentProfile {
  id               String    @id @default(cuid())
  userId           String    @unique
  emergencyContact String?
  guardianName     String?
  guardianPhone    String?
  bloodGroup       String?
  medicalInfo      String?
  institution      String?
  occupation       String?
  checkInDate      DateTime  @default(now())
  checkOutDate     DateTime?
  User             User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Room {
  id          String        @id @default(cuid())
  hostelId    String
  roomNumber  String
  type        RoomType
  capacity    Int
  occupied    Int           @default(0)
  price       Float
  status      RoomStatus    @default(AVAILABLE)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  images      String[]
  amenities   String[]
  Booking     Booking[]
  Hostel      Hostel        @relation(fields: [hostelId], references: [id])
  maintanance maintanance[]
  cleaning    CleaningLog[]
  laundry     LaundryLog[]
}

model CleaningLog {
  id        String   @id @default(cuid())
  roomId    String
  cleanedAt DateTime @default(now())
  cleanedBy String
  status    String   @default("COMPLETED")
  notes     String?
  Room      Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model LaundryLog {
  id          String    @id @default(cuid())
  roomId      String
  collectedAt DateTime  @default(now())
  deliveredAt DateTime?
  status      String    @default("COLLECTED") // COLLECTED, PROCESSING, DELIVERED
  notes       String?
  Room        Room      @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model Salary {
  id             String         @id @default(cuid())
  staffId        String
  month          String
  amount         Float
  basicSalary    Float
  allowances     Float          @default(0)
  bonuses        Float          @default(0)
  deductions     Float          @default(0)
  status         PaymentStatus  @default(PENDING)
  paymentDate    DateTime?
  paymentMethod  PaymentMethod?
  notes          String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  appealResponse String?
  appealStatus   String?        @default("NONE")
  appealText     String?
  StaffProfile   StaffProfile   @relation(fields: [staffId], references: [id])
}

model WardenPayment {
  id             String   @id @default(cuid())
  wardenId       String
  amount         Float
  basicSalary    Float    @default(0)
  bonuses        Float    @default(0)
  deductions     Float    @default(0)
  month          String
  status         String   @default("PAID")
  paymentMethod  String   @default("BANK_TRANSFER")
  paymentDate    DateTime @default(now())
  notes          String?
  type           String   @default("WARDEN_SALARY")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  appealResponse String?
  appealStatus   String?  @default("NONE")
  appealText     String?
  Warden         User     @relation(fields: [wardenId], references: [id])
}

model Session {
  id         String    @id @default(cuid())
  userId     String
  token      String?   @unique
  device     String?
  ipAddress  String?
  lastActive DateTime  @default(now())
  expiresAt  DateTime?
  isActive   Boolean   @default(true)
  createdAt  DateTime  @default(now())
  User       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model StaffProfile {
  id                String            @id @default(cuid())
  userId            String            @unique
  designation       String
  department        String?
  shift             String?
  basicSalary       Float             @default(0)
  allowances        Float             @default(0)
  joiningDate       DateTime          @default(now())
  documents         Json?
  totalTasksHandled Int               @default(0)
  performanceRating Float             @default(5.0)
  Salary            Salary[]
  User              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  attendance        StaffAttendance[]
}

model StaffAttendance {
  id             String       @id @default(cuid())
  staffProfileId String
  checkIn        DateTime     @default(now())
  checkOut       DateTime?
  status         String       @default("PRESENT") // PRESENT, LATE, ABSENT, LEAVE
  notes          String?
  StaffProfile   StaffProfile @relation(fields: [staffProfileId], references: [id], onDelete: Cascade)

  @@index([staffProfileId])
  @@index([checkIn])
}

model User {
  id                                         String             @id @default(cuid())
  name                                       String
  email                                      String             @unique
  password                                   String
  createdAt                                  DateTime           @default(now())
  updatedAt                                  DateTime           @updatedAt
  cnic                                       String?
  image                                      String?
  isActive                                   Boolean            @default(true)
  phone                                      String?
  role                                       UserRole           @default(GUEST)
  address                                    String?
  lastLogin                                  DateTime?
  city                                       String?
  hostelId                                   String?
  wardens                                    String[]
  uid                                        String?            @unique
  basicSalary                                Float?             @default(0)
  allowances                                 Float?             @default(0)
  Booking                                    Booking[]
  Complaint_Complaint_assignedToIdToUser     Complaint[]        @relation("Complaint_assignedToIdToUser")
  Complaint_Complaint_userIdToUser           Complaint[]        @relation("Complaint_userIdToUser")
  complaintComments                          ComplaintComment[]
  Expense_Expense_approvedByIdToUser         Expense[]          @relation("Expense_approvedByIdToUser")
  Expense_Expense_rejectedByIdToUser         Expense[]          @relation("Expense_rejectedByIdToUser")
  Expense_Expense_submittedByToUser          Expense[]          @relation("Expense_userIdToUser")
  Hostel_Hostel_managerIdToUser              Hostel[]           @relation("Hostel_managerIdToUser")
  Payment                                    Payment[]
  ResidentProfile                            ResidentProfile?
  Session                                    Session[]
  StaffProfile                               StaffProfile?
  assignedTasks                              StaffTask[]        @relation("Task_AssignedTo")
  createdTasks                               StaffTask[]        @relation("Task_CreatedBy")
  taskComments                               TaskComment[]
  Hostel_User_hostelIdToHostel               Hostel?            @relation("User_hostelIdToHostel", fields: [hostelId], references: [id])
  maintanance_maintanance_assignedToIdToUser maintanance[]      @relation("maintanance_assignedToIdToUser")
  maintanance_maintanance_userIdToUser       maintanance[]      @relation("maintanance_userIdToUser")
  refundRequests                             RefundRequest[]
  notices                                    Notice[]           @relation("NoticeAuthor")
  WardenPayment                              WardenPayment[]
}

model StaffTask {
  id           String        @id @default(cuid())
  uid          String?       @unique
  title        String
  description  String?
  status       TaskStatus    @default(PENDING)
  priority     TaskPriority  @default(MEDIUM)
  category     String?       @default("GENERAL")
  hostelId     String
  assignedToId String?
  createdById  String
  dueDate      DateTime?
  completedAt  DateTime?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  assignedTo   User?         @relation("Task_AssignedTo", fields: [assignedToId], references: [id])
  createdBy    User          @relation("Task_CreatedBy", fields: [createdById], references: [id])
  hostel       Hostel        @relation(fields: [hostelId], references: [id])
  comments     TaskComment[]
}

model TaskComment {
  id        String    @id @default(cuid())
  taskId    String
  userId    String
  message   String
  createdAt DateTime  @default(now())
  Task      StaffTask @relation(fields: [taskId], references: [id], onDelete: Cascade)
  User      User      @relation(fields: [userId], references: [id])
}

model maintanance {
  id                                  String    @id @default(cuid())
  hostelId                            String
  title                               String
  description                         String?
  status                              String    @default("PENDING")
  assignedToId                        String?
  resolutionNotes                     String?
  resolvedAt                          DateTime?
  images                              String[]
  createdAt                           DateTime  @default(now())
  updatedAt                           DateTime  @updatedAt
  userId                              String?
  priority                            String    @default("MEDIUM")
  roomId                              String?
  uid                                 String?   @unique
  User_maintanance_assignedToIdToUser User?     @relation("maintanance_assignedToIdToUser", fields: [assignedToId], references: [id])
  Hostel                              Hostel    @relation(fields: [hostelId], references: [id])
  Room                                Room?     @relation(fields: [roomId], references: [id])
  User_maintanance_userIdToUser       User?     @relation("maintanance_userIdToUser", fields: [userId], references: [id])
}

model resetPassword {
  id        String   @id @default(cuid())
  email     String   @unique
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  userId    String   @unique

  @@index([email])
}

model MessMenu {
  id            String   @id @default(cuid())
  hostelId      String
  dayOfWeek     String // e.g. "MONDAY", "TUESDAY"
  breakfast     String?
  breakfastTime String?
  lunch         String?
  lunchTime     String?
  dinner        String?
  dinnerTime    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  Hostel        Hostel   @relation(fields: [hostelId], references: [id], onDelete: Cascade)
}

model Notice {
  id          String   @id @default(cuid())
  title       String
  content     String
  targetRoles String[] // e.g. ["GUEST", "WARDEN"]
  hostelId    String? // Null means global notice
  authorId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  Author      User     @relation("NoticeAuthor", fields: [authorId], references: [id])
  Hostel      Hostel?  @relation(fields: [hostelId], references: [id])
}

enum UserRole {
  ADMIN
  WARDEN
  GUEST
  STAFF
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  CHECKED_IN
  CHECKED_OUT
  REJECTED
}

enum RoomType {
  SINGLE
  DOUBLE
  TRIPLE
  QUAD
}

enum RoomStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
}

enum ComplaintStatus {
  PENDING
  IN_PROGRESS
  RESOLVED
  REJECTED
}

enum ComplaintPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ComplaintCategory {
  MAINTENANCE
  CLEANING
  NOISE
  SECURITY
  INTERNET
  OTHER
}

enum ExpenseStatus {
  PENDING
  APPROVED
  REJECTED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  JAZZCASH
  EASYPAISA
}

enum PaymentType {
  SECURITY_DEPOSIT
  MONTHLY_RENT
  GUEST_STAY
  OTHER
}

enum RefundStatus {
  PENDING
  APPROVED
  REJECTED
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
}
