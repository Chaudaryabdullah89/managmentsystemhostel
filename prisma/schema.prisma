generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Booking {
  id              String        @id @default(cuid())
  uid             String?       @unique
  userId          String
  roomId          String
  checkIn         DateTime
  checkOut        DateTime?
  status          BookingStatus @default(PENDING)
  totalAmount     Float
  securityDeposit Float         @default(0)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  Room            Room          @relation(fields: [roomId], references: [id])
  User            User          @relation(fields: [userId], references: [id])
  Hostel          Hostel?       @relation(fields: [hostelId], references: [id])
  hostelId        String?
  Payment         Payment[]

  @@index([userId])
  @@index([hostelId])
  @@index([status])
  isDeleted       Boolean   @default(false)
  deletedAt       DateTime?
}

model Complaint {
  id                                String             @id @default(cuid())
  userId                            String
  hostelId                          String?
  description                       String
  status                            ComplaintStatus    @default(PENDING)
  priority                          ComplaintPriority  @default(MEDIUM)
  category                          ComplaintCategory?
  assignedToId                      String?
  resolvedAt                        DateTime?
  createdAt                         DateTime           @default(now())
  updatedAt                         DateTime           @updatedAt
  User_Complaint_assignedToIdToUser User?              @relation("Complaint_assignedToIdToUser", fields: [assignedToId], references: [id])
  Hostel                            Hostel?            @relation(fields: [hostelId], references: [id])
  User_Complaint_userIdToUser       User               @relation("Complaint_userIdToUser", fields: [userId], references: [id])
  comments                          ComplaintComment[]
  roomNumber                        String?
  uid                               String?            @unique
  title                             String?
  resolutionNotes                   String?
  images                            String[]

  @@index([userId])
  @@index([hostelId])
  @@index([status])
  isDeleted       Boolean   @default(false)
  deletedAt       DateTime?
}

model ComplaintComment {
  id          String    @id @default(cuid())
  complaintId String
  userId      String
  message     String
  createdAt   DateTime  @default(now())
  Complaint   Complaint @relation(fields: [complaintId], references: [id], onDelete: Cascade)
  User        User      @relation(fields: [userId], references: [id])
}

model Expense {
  id                               String        @id @default(cuid())
  hostelId                         String
  submittedById                    String
  title                            String
  amount                           Float
  category                         String
  status                           ExpenseStatus @default(PENDING)
  description                      String?
  date                             DateTime      @default(now())
  receiptImage                     String?
  receiptUrl                       String?
  approvedById                     String?
  rejectedById                     String?
  rejectionReason                  String?
  createdAt                        DateTime      @default(now())
  updatedAt                        DateTime      @updatedAt
  User_Expense_approvedByIdToUser  User?         @relation("Expense_Expense_approvedByIdToUser", fields: [approvedById], references: [id])
  Hostel                           Hostel        @relation(fields: [hostelId], references: [id])
  User_Expense_rejectedByIdToUser  User?         @relation("Expense_Expense_rejectedByIdToUser", fields: [rejectedById], references: [id])
  User_Expense_submittedByIdToUser User          @relation("Expense_Expense_submittedByIdToUser", fields: [submittedById], references: [id])
  isDeleted       Boolean   @default(false)
  deletedAt       DateTime?
}

model Hostel {
  id               String   @id @default(cuid())
  name             String
  type             String   @default("BOYS")
  address          String
  city             String?
  state            String?
  country          String?  @default("Pakistan")
  phone            String?
  email            String?
  description      String?
  floors           Int      @default(1)
  rooms            Int?     @default(0)
  managerId        String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  completeAddress  String?
  laundryAvailable Boolean? @default(false)
  messAvailable    Boolean? @default(false)
  monthlyRent      Float?   @default(0)
  perNightRent     Float?   @default(0)
  status           String?  @default("ACTIVE")
  wardens          String[]
  zip              String?
  cleaningInterval Int?     @default(24)
  laundryInterval  Int?     @default(48)
  image            String?
  street           String?

  Booking                    Booking[]
  Complaint                  Complaint[]
  Expense                    Expense[]
  Manager                    User?           @relation("Hostel_managerIdToUser", fields: [managerId], references: [id])
  MessMenu                   MessMenu[]
  Notice                     Notice[]
  Room                       Room[]
  StaffTask                  StaffTask[]
  User_User_hostelIdToHostel User[]          @relation("User_hostelIdToHostel")
  maintanance                maintanance[]
  payments                   Payment[]
  refundRequests             RefundRequest[]
  isDeleted       Boolean   @default(false)
  deletedAt       DateTime?
}

model OtpVerification {
  id        String   @id @default(cuid())
  email     String
  otp       String
  expiresAt DateTime
  type      String?  @default("EMAIL_VERIFICATION")
  createdAt DateTime @default(now())
}

model Payment {
  id             String          @id @default(cuid())
  userId         String
  amount         Float
  status         PaymentStatus   @default(PENDING)
  method         PaymentMethod   @default(CASH)
  type           PaymentType?
  transactionId  String?
  date           DateTime        @default(now())
  paymentDate    DateTime        @default(now())
  dueDate        DateTime?
  month          String?
  year           Int?
  uid            String?         @unique
  notes          String?
  receiptUrl     String?
  receiptImage   String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  User           User            @relation(fields: [userId], references: [id])
  hostelId       String?
  hostel         Hostel?         @relation(fields: [hostelId], references: [id])
  bookingId      String?
  Booking        Booking?        @relation(fields: [bookingId], references: [id])
  refundRequests RefundRequest[]

  @@index([userId])
  @@index([bookingId])
  @@index([hostelId])
  @@index([status])
  isDeleted       Boolean   @default(false)
  deletedAt       DateTime?
}

model RefundRequest {
  id          String       @id @default(cuid())
  userId      String
  hostelId    String
  amount      Float
  reason      String
  status      RefundStatus @default(PENDING)
  processedAt DateTime?
  adminNotes  String?
  paymentId   String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  Hostel      Hostel       @relation(fields: [hostelId], references: [id], onDelete: Cascade)
  User        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  Payment     Payment?     @relation(fields: [paymentId], references: [id])
}

model ResidentProfile {
  id               String   @id @default(cuid())
  userId           String   @unique
  guardianName     String
  guardianPhone    String
  bloodGroup       String?
  emergencyContact String?
  address          String?
  city             String?
  currentHostelId  String?
  currentRoomId    String?
  documents        String[]
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  User             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Room {
  id               String        @id @default(cuid())
  hostelId         String
  roomNumber       String
  type             RoomType
  status           RoomStatus    @default(AVAILABLE)
  capacity         Int
  occupied         Int           @default(0)
  price            Float
  features         String[]
  amenities        String[]
  description      String?
  images           String[]
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  floor            Int           @default(1)
  monthlyrent      Float?
  pricepernight    Float?
  cleaningInterval Int?          @default(24)
  lastCleaningAt   DateTime?
  lastLaundryAt    DateTime?
  laundryInterval  Int?          @default(48)
  Booking          Booking[]
  Hostel           Hostel        @relation(fields: [hostelId], references: [id], onDelete: Cascade)
  cleaning         CleaningLog[]
  laundry          LaundryLog[]
  maintanance      maintanance[]
  isDeleted       Boolean   @default(false)
  deletedAt       DateTime?
}

model CleaningLog {
  id        String   @id @default(cuid())
  roomId    String
  cleanedAt DateTime @default(now())
  cleanedBy String
  status    String   @default("COMPLETED")
  notes     String?
  hostelId  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Room      Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model LaundryLog {
  id          String    @id @default(cuid())
  roomId      String
  collectedAt DateTime  @default(now())
  deliveredAt DateTime?
  status      String    @default("COLLECTED") // COLLECTED, PROCESSING, DELIVERED
  notes       String?
  hostelId    String?
  itemsCount  Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  Room        Room      @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model Salary {
  id             String       @id @default(cuid())
  staffProfileId String
  amount         Float
  month          String
  status         String       @default("UNPAID")
  paymentDate    DateTime?
  transactionId  String?
  basicSalary    Float        @default(0)
  allowances     Float        @default(0)
  bonuses        Float        @default(0)
  deductions     Float        @default(0)
  paymentMethod  String?      @default("CASH")
  notes          String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  StaffProfile   StaffProfile @relation(fields: [staffProfileId], references: [id], onDelete: Cascade)
  isDeleted       Boolean   @default(false)
  deletedAt       DateTime?
}

model WardenPayment {
  id            String    @id @default(cuid())
  wardenId      String
  amount        Float
  month         String
  status        String    @default("UNPAID")
  paymentDate   DateTime?
  notes         String?
  basicSalary   Float     @default(0)
  allowances    Float     @default(0)
  bonuses       Float     @default(0)
  deductions    Float     @default(0)
  paymentMethod String?   @default("CASH")
  type          String?   @default("WARDEN_SALARY")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  Warden        User      @relation(fields: [wardenId], references: [id], onDelete: Cascade)
}

model Session {
  id         String   @id @default(cuid())
  token      String   @unique
  userId     String
  expiresAt  DateTime
  device     String?
  ipAddress  String?
  lastActive DateTime @default(now())
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model StaffProfile {
  id                String            @id @default(cuid())
  userId            String            @unique
  designation       String
  department        String
  joiningDate       DateTime          @default(now())
  basicSalary       Float
  allowances        Float?            @default(0)
  shift             String?
  documents         String[]
  bankName          String?
  accountNumber     String?
  ifscCode          String?
  address           String?
  emergencyContact  String?
  status            String            @default("ACTIVE")
  totalTasksHandled Int               @default(0)
  lastSalaryProcess DateTime?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  Salary            Salary[]
  User              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  attendance        StaffAttendance[]
}

model StaffAttendance {
  id             String       @id @default(cuid())
  staffProfileId String
  checkIn        DateTime     @default(now())
  checkOut       DateTime?
  status         String       @default("PRESENT") // PRESENT, LATE, ABSENT, LEAVE
  notes          String?
  StaffProfile   StaffProfile @relation(fields: [staffProfileId], references: [id], onDelete: Cascade)

  @@index([staffProfileId])
  @@index([checkIn])
}

model User {
  id                                         String             @id @default(cuid())
  name                                       String
  email                                      String             @unique
  password                                   String
  createdAt                                  DateTime           @default(now())
  updatedAt                                  DateTime           @updatedAt
  cnic                                       String?
  image                                      String?
  isActive                                   Boolean            @default(true)
  phone                                      String?
  role                                       UserRole           @default(GUEST)
  address                                    String?
  lastLogin                                  DateTime?
  city                                       String?
  hostelId                                   String?
  wardens                                    String[]
  uid                                        String?            @unique
  basicSalary                                Float?             @default(0)
  allowances                                 Float?             @default(0)
  Booking                                    Booking[]
  Complaint_Complaint_assignedToIdToUser     Complaint[]        @relation("Complaint_assignedToIdToUser")
  Complaint_Complaint_userIdToUser           Complaint[]        @relation("Complaint_userIdToUser")
  complaintComments                          ComplaintComment[]
  Expense_Expense_approvedByIdToUser         Expense[]          @relation("Expense_Expense_approvedByIdToUser")
  Expense_Expense_rejectedByIdToUser         Expense[]          @relation("Expense_Expense_rejectedByIdToUser")
  Expense_Expense_submittedByIdToUser        Expense[]          @relation("Expense_Expense_submittedByIdToUser")
  Hostel_Hostel_managerIdToUser              Hostel[]           @relation("Hostel_managerIdToUser")
  Payment                                    Payment[]
  ResidentProfile                            ResidentProfile?
  Session                                    Session[]
  StaffProfile                               StaffProfile?
  assignedTasks                              StaffTask[]        @relation("Task_AssignedTo")
  createdTasks                               StaffTask[]        @relation("Task_CreatedBy")
  taskComments                               TaskComment[]
  Hostel_User_hostelIdToHostel               Hostel?            @relation("User_hostelIdToHostel", fields: [hostelId], references: [id])
  maintanance_maintanance_assignedToIdToUser maintanance[]      @relation("maintanance_assignedToIdToUser")
  maintanance_maintanance_userIdToUser       maintanance[]      @relation("maintanance_userIdToUser")
  refundRequests                             RefundRequest[]
  notices                                    Notice[]           @relation("NoticeAuthor")
  WardenPayment                              WardenPayment[]
  isDeleted       Boolean   @default(false)
  deletedAt       DateTime?
}

model StaffTask {
  id           String        @id @default(cuid())
  uid          String?       @unique
  title        String
  description  String?
  status       TaskStatus    @default(PENDING)
  priority     TaskPriority  @default(MEDIUM)
  category     String?       @default("GENERAL")
  hostelId     String
  assignedToId String?
  createdById  String
  dueDate      DateTime?
  completedAt  DateTime?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  assignedTo   User?         @relation("Task_AssignedTo", fields: [assignedToId], references: [id])
  createdBy    User          @relation("Task_CreatedBy", fields: [createdById], references: [id])
  hostel       Hostel        @relation(fields: [hostelId], references: [id])
  comments     TaskComment[]

  @@index([hostelId])
  @@index([assignedToId])
}

model TaskComment {
  id        String    @id @default(cuid())
  taskId    String
  userId    String
  message   String
  createdAt DateTime  @default(now())
  StaffTask StaffTask @relation(fields: [taskId], references: [id], onDelete: Cascade)
  User      User      @relation(fields: [userId], references: [id])
}

model maintanance {
  id              String    @id @default(cuid())
  title           String
  description     String
  status          String    @default("PENDING")
  priority        String    @default("MEDIUM")
  hostelId        String
  roomId          String?
  userId          String
  assignedToId    String?
  resolvedAt      DateTime?
  resolutionNotes String?
  images          String[]
  uid             String?   @unique
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  assignedTo      User?     @relation("maintanance_assignedToIdToUser", fields: [assignedToId], references: [id])
  Hostel          Hostel    @relation(fields: [hostelId], references: [id], onDelete: Cascade)
  Room            Room?     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  User            User      @relation("maintanance_userIdToUser", fields: [userId], references: [id])
  maintanance_id  String?

  @@index([userId])
  @@index([roomId])
  @@index([hostelId])
  @@index([status])
}

model resetPassword {
  id        String   @id @default(cuid())
  email     String
  otp       String
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model MessMenu {
  id            String   @id @default(cuid())
  hostelId      String
  dayOfWeek     String
  breakfast     String?
  breakfastTime String?
  lunch         String?
  lunchTime     String?
  dinner        String?
  dinnerTime    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  Hostel        Hostel   @relation(fields: [hostelId], references: [id], onDelete: Cascade)
}

model Notice {
  id          String    @id @default(cuid())
  title       String
  content     String
  priority    String    @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  category    String    @default("GENERAL") // GENERAL, MAINTENANCE, SECURITY, EVENT
  targetRoles String[] // e.g. ["GUEST", "WARDEN"]
  hostelId    String? // Null means global notice
  authorId    String
  expiresAt   DateTime?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  author      User      @relation("NoticeAuthor", fields: [authorId], references: [id])
  hostel      Hostel?   @relation(fields: [hostelId], references: [id])
  isDeleted       Boolean   @default(false)
  deletedAt       DateTime?
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  WARDEN
  GUEST
  STAFF
  RESIDENT
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  CHECKED_IN
  REJECTED
  COMPLETED
}

enum RoomType {
  SINGLE
  DOUBLE
  TRIPLE
  QUAD
}

enum RoomStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
  CLEANING
}

enum ComplaintStatus {
  PENDING
  IN_PROGRESS
  RESOLVED
}

enum ComplaintPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ComplaintCategory {
  MAINTENANCE
  CLEANING
  CLEANLINESS
  MESS
  SECURITY
  INTERNET
  NOISE
  OTHER
}

enum ExpenseStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  OVERDUE
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  ONLINE
}

enum PaymentType {
  MONTHLY_RENT
  SECURITY_DEPOSIT
  RENT
  LATE_FEE
  SECURITY_REFUND
  ADVANCE
  OTHER
}

enum RefundStatus {
  PENDING
  APPROVED
  REJECTED
  PROCESSED
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}
